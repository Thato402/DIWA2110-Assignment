{"ast":null,"code":"import _objectSpread from\"C:/Users/DELL/track/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useState}from'react';import axios from'axios';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";function Sales(){const[products,setProducts]=useState([]);const[selectedItems,setSelectedItems]=useState([]);const[error,setError]=useState('');useEffect(()=>{axios.get('/products').then(res=>setProducts(res.data)).catch(err=>console.error(err));},[]);const handleCheckboxChange=productId=>{setSelectedItems(prev=>{if(prev.some(item=>item.productId===productId)){return prev.filter(item=>item.productId!==productId);}else{return[...prev,{productId,quantity:1}];// Default to 1\n}});};const handleQuantityChange=(productId,value)=>{const qty=parseInt(value)||1;// Default to 1 if invalid\nsetSelectedItems(prev=>prev.map(item=>item.productId===productId?_objectSpread(_objectSpread({},item),{},{quantity:qty}):item));};const handleRemoveQuantity=productId=>{setSelectedItems(prev=>prev.map(item=>item.productId===productId?_objectSpread(_objectSpread({},item),{},{quantity:undefined}):item).filter(item=>item.productId!==productId||item.quantity!==undefined));};const handleSubmit=e=>{e.preventDefault();if(selectedItems.length===0){setError('Please select at least one product');return;}const validItems=selectedItems.map(item=>({productId:item.productId,quantity:item.quantity// Can be undefined, handled by backend\n}));axios.post('/sales',validItems).then(()=>{alert('Sale recorded successfully');setSelectedItems([]);setError('');axios.get('/products').then(res=>setProducts(res.data));// Refresh products\n}).catch(err=>{var _err$response,_err$response$data;setError(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.error)||'An error occurred');});};const calculateTotal=()=>{return selectedItems.reduce((sum,item)=>{const product=products.find(p=>p.id===parseInt(item.productId));const qty=item.quantity||1;// Default to 1 if not set\nreturn sum+((product===null||product===void 0?void 0:product.price)*qty||0);},0);};return/*#__PURE__*/_jsxs(\"div\",{className:\"content\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Sales\"}),error&&/*#__PURE__*/_jsx(\"p\",{style:{color:'#000000'},children:error}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(\"div\",{className:\"product-list\",children:products.map(product=>{var _product$price,_selectedItems$find;return/*#__PURE__*/_jsxs(\"div\",{className:\"product-list-item\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:selectedItems.some(item=>item.productId===product.id),onChange:()=>handleCheckboxChange(product.id)}),/*#__PURE__*/_jsxs(\"span\",{children:[product.name,\" (Stock: \",product.quantity,\", Price: M\",(_product$price=product.price)===null||_product$price===void 0?void 0:_product$price.toFixed(2),\")\"]}),selectedItems.some(item=>item.productId===product.id)&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",min:\"1\",value:((_selectedItems$find=selectedItems.find(item=>item.productId===product.id))===null||_selectedItems$find===void 0?void 0:_selectedItems$find.quantity)||1,onChange:e=>handleQuantityChange(product.id,e.target.value)}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>handleRemoveQuantity(product.id),children:\"Remove Qty\"})]})]},product.id);})}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",children:\"Record Sale\"})]}),selectedItems.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"receipt\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Receipt\"}),selectedItems.map((item,index)=>{var _product$price2;const product=products.find(p=>p.id===parseInt(item.productId));const qty=item.quantity||1;return/*#__PURE__*/_jsxs(\"div\",{className:\"receipt-item\",children:[product===null||product===void 0?void 0:product.name,\": \",qty,\" x M\",product===null||product===void 0?void 0:(_product$price2=product.price)===null||_product$price2===void 0?void 0:_product$price2.toFixed(2),\" = M\",((product===null||product===void 0?void 0:product.price)*qty||0).toFixed(2)]},index);}),/*#__PURE__*/_jsx(\"div\",{className:\"receipt-item\",children:/*#__PURE__*/_jsxs(\"strong\",{children:[\"Total: M\",calculateTotal().toFixed(2)]})})]})]});}export default Sales;","map":{"version":3,"names":["React","useEffect","useState","axios","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","Sales","products","setProducts","selectedItems","setSelectedItems","error","setError","get","then","res","data","catch","err","console","handleCheckboxChange","productId","prev","some","item","filter","quantity","handleQuantityChange","value","qty","parseInt","map","_objectSpread","handleRemoveQuantity","undefined","handleSubmit","e","preventDefault","length","validItems","post","alert","_err$response","_err$response$data","response","calculateTotal","reduce","sum","product","find","p","id","price","className","children","style","color","onSubmit","_product$price","_selectedItems$find","type","checked","onChange","name","toFixed","min","target","onClick","index","_product$price2"],"sources":["C:/Users/DELL/track/frontend/src/components/Sales.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport axios from 'axios';\r\n\r\nfunction Sales() {\r\n  const [products, setProducts] = useState([]);\r\n  const [selectedItems, setSelectedItems] = useState([]);\r\n  const [error, setError] = useState('');\r\n\r\n  useEffect(() => {\r\n    axios.get('/products')\r\n      .then(res => setProducts(res.data))\r\n      .catch(err => console.error(err));\r\n  }, []);\r\n\r\n  const handleCheckboxChange = (productId) => {\r\n    setSelectedItems(prev => {\r\n      if (prev.some(item => item.productId === productId)) {\r\n        return prev.filter(item => item.productId !== productId);\r\n      } else {\r\n        return [...prev, { productId, quantity: 1 }]; // Default to 1\r\n      }\r\n    });\r\n  };\r\n\r\n  const handleQuantityChange = (productId, value) => {\r\n    const qty = parseInt(value) || 1; // Default to 1 if invalid\r\n    setSelectedItems(prev =>\r\n      prev.map(item =>\r\n        item.productId === productId ? { ...item, quantity: qty } : item\r\n      )\r\n    );\r\n  };\r\n\r\n  const handleRemoveQuantity = (productId) => {\r\n    setSelectedItems(prev =>\r\n      prev.map(item =>\r\n        item.productId === productId ? { ...item, quantity: undefined } : item\r\n      ).filter(item => item.productId !== productId || item.quantity !== undefined)\r\n    );\r\n  };\r\n\r\n  const handleSubmit = (e) => {\r\n    e.preventDefault();\r\n    if (selectedItems.length === 0) {\r\n      setError('Please select at least one product');\r\n      return;\r\n    }\r\n    const validItems = selectedItems.map(item => ({\r\n      productId: item.productId,\r\n      quantity: item.quantity // Can be undefined, handled by backend\r\n    }));\r\n    axios.post('/sales', validItems)\r\n      .then(() => {\r\n        alert('Sale recorded successfully');\r\n        setSelectedItems([]);\r\n        setError('');\r\n        axios.get('/products').then(res => setProducts(res.data)); // Refresh products\r\n      })\r\n      .catch(err => {\r\n        setError(err.response?.data?.error || 'An error occurred');\r\n      });\r\n  };\r\n\r\n  const calculateTotal = () => {\r\n    return selectedItems.reduce((sum, item) => {\r\n      const product = products.find(p => p.id === parseInt(item.productId));\r\n      const qty = item.quantity || 1; // Default to 1 if not set\r\n      return sum + (product?.price * qty || 0);\r\n    }, 0);\r\n  };\r\n\r\n  return (\r\n    <div className=\"content\">\r\n      <h2>Sales</h2>\r\n      {error && <p style={{ color: '#000000' }}>{error}</p>}\r\n      <form onSubmit={handleSubmit}>\r\n        <div className=\"product-list\">\r\n          {products.map(product => (\r\n            <div key={product.id} className=\"product-list-item\">\r\n              <input\r\n                type=\"checkbox\"\r\n                checked={selectedItems.some(item => item.productId === product.id)}\r\n                onChange={() => handleCheckboxChange(product.id)}\r\n              />\r\n              <span>{product.name} (Stock: {product.quantity}, Price: M{product.price?.toFixed(2)})</span>\r\n              {selectedItems.some(item => item.productId === product.id) && (\r\n                <>\r\n                  <input\r\n                    type=\"number\"\r\n                    min=\"1\"\r\n                    value={selectedItems.find(item => item.productId === product.id)?.quantity || 1}\r\n                    onChange={(e) => handleQuantityChange(product.id, e.target.value)}\r\n                  />\r\n                  <button type=\"button\" onClick={() => handleRemoveQuantity(product.id)}>Remove Qty</button>\r\n                </>\r\n              )}\r\n            </div>\r\n          ))}\r\n        </div>\r\n        <button type=\"submit\">Record Sale</button>\r\n      </form>\r\n      {selectedItems.length > 0 && (\r\n        <div className=\"receipt\">\r\n          <h3>Receipt</h3>\r\n          {selectedItems.map((item, index) => {\r\n            const product = products.find(p => p.id === parseInt(item.productId));\r\n            const qty = item.quantity || 1;\r\n            return (\r\n              <div key={index} className=\"receipt-item\">\r\n                {product?.name}: {qty} x M{product?.price?.toFixed(2)} = M{(product?.price * qty || 0).toFixed(2)}\r\n              </div>\r\n            );\r\n          })}\r\n          <div className=\"receipt-item\"><strong>Total: M{calculateTotal().toFixed(2)}</strong></div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Sales;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}